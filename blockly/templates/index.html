{% load static %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>HARDWARIO Visual Editor</title>

  <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.indigo-pink.min.css">
  <link rel="stylesheet" href="{% static 'css/index.css' %}">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>

<body>
  <div>
    <div id="blocklyArea" class="area"></div>
    <div id="blocklyDiv" style="position: absolute"></div>
    <xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none"></xml>
    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
      <category name="Initialization" colour="#E30427">
        <block type="application_init"></block>
        <block type="initialize_button">
          <field name="GPIO">TWR_GPIO_BUTTON</field>
          <field name="PULL">TWR_GPIO_PULL_DOWN</field>
          <field name="STATE">TRUE</field>
        </block>
        <block type="initialize_radio">
          <field name="RADIO_MODE">TWR_RADIO_MODE_NODE_SLEEPING</field>
          <field name="FIRMWARE_NAME">twr-blockly-firmware</field>
        </block>
        <block type="initialize_led"></block>
        <block type="initialize_logging"></block>
        <block type="initialize_core_module_tmp112">
          <field name="UPDATE_INTERVAL">5000</field>
        </block>
        <block type="initialize_motion_detector">
          <field name="SENSITIVITY">TWR_MODULE_PIR_SENSITIVITY_LOW</field>
        </block>
        <block type="initialize_power_module"></block>
        <block type="initialize_led_strip">
          <field name="LEDS">36</field>
        </block>
        <block type="initialize_lcd"></block>
      </category>
      <category name="Controls" colour="#E30427">
        <block type="application_task">
          <field name="task_interval">1000</field>
        </block>
        <block type="controls_if"></block>
        <block type="controls_for">
          <field name="VAR" id="4_;tDP{{.XS50_p!:Ov8">i</field>
        </block>
        <block type="controls_whileUntil">
          <field name="MODE">WHILE</field>
        </block>
      </category>
      <category name="Button" colour="#009900">
        <block type="on_button">
          <field name="NAME">PRESS</field>
        </block>
        <block type="publish_button_event_count"></block>
        <block type="button_clicks"></block>
        <block type="button_holds"></block>
      </category>
      <category name="Radio" colour="#CC6600">
        <block type="send_over_radio_string">
          <field name="STRING_TO_BE_SEND">STRING</field>
          <field name="SUBTOPIC">string</field>
        </block>
        <block type="send_over_radio_int">
          <field name="INT_TO_BE_SEND">1</field>
          <field name="SUBTOPIC">int</field>
        </block>
        <block type="send_over_radio_float">
          <field name="FLOAT_TO_BE_SEND">1.0</field>
          <field name="SUBTOPIC">float</field>
        </block>
        <block type="send_over_radio_boolean">
          <field name="BOOL_TO_BE_SEND">true</field>
          <field name="SUBTOPIC">bool</field>
        </block>
      </category>
      <category name="LED" colour="#FF3333">
        <block type="led_blink">
          <field name="COUNT">1</field>
        </block>
        <block type="led_pulse">
          <field name="DURATION">1000</field>
        </block>
        <block type="led_mode">
          <field name="MODE">TWR_LED_MODE_BLINK</field>
        </block>
      </category>
      <category name="Logging" colour="#6600CC">
        <block type="log_info">
          <field name="MESSAGE">Info</field>
        </block>
        <block type="log_warning">
          <field name="MESSAGE">Warning</field>
        </block>
        <block type="log_debug">
          <field name="MESSAGE">Debug</field>
        </block>
        <block type="log_error">
          <field name="MESSAGE">Error</field>
        </block>
      </category>
      <category name="Temperature" colour="#0066CC">
        <block type="core_temperature"></block>
      </category>
      <category name="Motion Detector">
        <block type="on_movement"></block>
      </category>
      <category name="Power Module">
        <block type="power_module_relay_set_state">
          <field name="STATE">ON</field>
        </block>
        <block type="power_module_relay_state"></block>
      </category>
      <category name="LCD Module">
        <block type="lcd_set_font">
          <field name="FONT">twr_font_ubuntu_11</field>
        </block>
        <block type="lcd_clear"></block>
        <block type="lcd_update"></block>
        <block type="lcd_power_state">
          <field name="STATE">ON</field>
        </block>
        <block type="lcd_draw_string">
          <field name="STRING">String</field>
          <field name="LEFT">0</field>
          <field name="TOP">0</field>
        </block>
        <block type="lcd_draw_circle">
          <field name="CENTER_X">0</field>
          <field name="CENTER_Y">0</field>
          <field name="RADIUS">0</field>
        </block>
        <block type="lcd_draw_line">
          <field name="START_X">0</field>
          <field name="START_Y">0</field>
          <field name="END_X">0</field>
          <field name="END_Y">0</field>
        </block>
        <block type="lcd_draw_rectangle">
          <field name="START_X">0</field>
          <field name="START_Y">0</field>
          <field name="END_X">0</field>
          <field name="END_Y">0</field>
        </block>
        <block type="lcd_draw_pixel">
          <field name="LEFT">0</field>
          <field name="TOP">0</field>
        </block>
      </category>
      <category name="Values" colour="#E30427">
        <block type="integer_value">
          <field name="VALUE">0</field>
        </block>
        <block type="string_value">
          <field name="VALUE">text</field>
        </block>
      </category>
      <category name="Variables" colour="#a55b80" custom="VARIABLE"></category>
      <category name="Logic" colour="#5b80a5">
        <block type="controls_if"></block>
        <block type="logic_compare">
          <field name="OP">EQ</field>
        </block>
        <block type="logic_operation">
          <field name="OP">AND</field>
        </block>
        <block type="logic_negate"></block>
        <block type="logic_boolean">
          <field name="BOOL">TRUE</field>
        </block>
      </category>
      <category name="Math" colour="#5b67a5">
        <block type="math_number">
          <field name="NUM">0</field>
        </block>
        <block type="math_arithmetic">
          <field name="OP">ADD</field>
          <value name="A">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Loops" colour="#5ba55b">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="controls_whileUntil">
          <field name="MODE">WHILE</field>
        </block>
        <block type="controls_for">
          <field name="VAR" id="1h4XEs!uj]o~Q3f#Bh~;">i</field>
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
      </category>
    </xml>
  </xml>     
</div>

<button class="btn btn-primary" id="connectButton" type="button">Flash</button>
<button class="btn btn-primary" onclick="connectDevices()">Connect Device</button>

<script type="module" src="{% static 'js/flasher.js' %}"></script>

<script src="https://unpkg.com/blockly"></script>  
<script src="{% static 'js/blocks.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
  function parse_code(){
    $.ajax({
      url: "/parse_code",
      type: "GET",
          data: {
          Code: exportJSON(),
      },
  
    }).done(function() {
      window.location = "/download_code";
    });
  }
  </script>
  
<input id="compileAndDownload" type="button" class="btn btn-success" value="Compile And Download" onclick="parse_code();" />


<button class="btn btn-warning" onclick="save()">Save Workspace</button>
<button class="btn btn-warning" onclick="restore()">Load Workspace</button>

<button class="btn btn-warning" onclick="exportWorkspace()">Export Workspace</button>
<input class="form-control form-control-sm" id="importFile" type="file" onchange="importWorkspace()" />

</body>
</html>
